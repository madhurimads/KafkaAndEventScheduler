package gov.irs.fatca.qi.service.user;

import java.util.ArrayList;
import java.util.Collection;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.security.web.authentication.preauth.PreAuthenticatedAuthenticationProvider;

import gov.irs.fatca.qi.service.impl.CheckUserExistenceClientImpl;
import gov.irs.fatca.qi.ui.security.AuthenticatedUserDetails;

public class SiteMinderUserDetailsService implements UserDetailsService {

    protected Logger logger = LoggerFactory.getLogger(this.getClass());

    private static final String DEFAULT_SECURITY_USER_ROLE = "ROLE_USER";
    private static final String DEFAULT_SECURITY_USER_PASSWORD = "N/A";

    private String dummySecurityUserPassword = DEFAULT_SECURITY_USER_PASSWORD;
    private String securityUserRole = DEFAULT_SECURITY_USER_ROLE;

    @Autowired
    CheckUserExistenceClientImpl checkUserExistenceClientImpl;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {

        /* username is the sadi Id coming from the Siteminder HTTP headers */
        String sadiId = username;

        // Get this user details from database and set its roles also here
        Collection<GrantedAuthority> authorities = new ArrayList<GrantedAuthority>();
        authorities.add(new SimpleGrantedAuthority(securityUserRole));

        AuthenticatedUserDetails authenticatedUserDetails = new AuthenticatedUserDetails(sadiId,
                dummySecurityUserPassword, true, true, true, true, authorities);

        return authenticatedUserDetails;
    }

    /**
     * @return the dummySecurityUserPassword
     */
    public String getDummySecurityUserPassword() {
        return dummySecurityUserPassword;
    }

    /**
     * @param dummySecurityUserPassword
     *            the dummySecurityUserPassword to set
     */
    public void setDummySecurityUserPassword(String dummySecurityUserPassword) {
        this.dummySecurityUserPassword = dummySecurityUserPassword;
    }

    /**
     * @return the securityUserRole
     */
    public String getSecurityUserRole() {
        return securityUserRole;
    }

    /**
     * @param securityUserRole
     *            the securityUserRole to set
     */
    public void setSecurityUserRole(String securityUserRole) {
        this.securityUserRole = securityUserRole;
    }
}
