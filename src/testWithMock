package gov.irs.fatca.qi.strategy.impl.test;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertFalse;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.test.context.ActiveProfiles;

import gov.irs.fatca.qi.application.model.AccountInformation;
import gov.irs.fatca.qi.strategy.ScreeningStrategy;
import gov.irs.fatca.qi.strategy.impl.OfacParsingStrategyImpl;
import gov.irs.fatca.qi.strategy.impl.ScreeningStrategyImpl;

@ExtendWith(MockitoExtension.class)
@ActiveProfiles("local")
public class OfacScreeningStrategyImplIntegrationTest {

    OfacParsingStrategyImpl ofacScreeningStrategy;

    ScreeningStrategy screeningStrategy;
    
    @BeforeEach
    public void setup() {
    	ofacScreeningStrategy = new OfacParsingStrategyImpl();
    	screeningStrategy = new ScreeningStrategyImpl();
    }

    @Test
    public void parseLegalNameTest() {
        String testString = "  ..'a  b9090 #})({ c  d1452-..[]'e  f  g    h   i {}  j k '35479. l %#   m  /&' n- O P - q &&%[)  r  s ({['  t u V -'.8564'.  w..-''-x656863--   --y--465456.''.'.'.'-- z   ";
        String result = ofacScreeningStrategy.parseLegalName(testString);
        assertEquals("A B C D E F G H I J K L M N O P Q R S T U V W X Y Z", result);
    }

    @Test
    public void parseItinTest() {
        String testString = "  ..'a  b \" \"  c  d.'-..'e  f  g    h   i   j k ''.'. l   m n- O P - q   r  s   t u V -'.\"\"'.  w..-''-x--   --y--.''.'.'.'-- z   ";
        String result = ofacScreeningStrategy.parseItin(testString);
        assertEquals("A B C D E F G H I J K L M N O P Q R S T U V W X Y Z", result);
    }

    @Test
    public void testOfacMatch() {
        String legalName = "ZIMBABWE DEFENCE INDUSTRIES (PVT) LTD";
        String itinName = "ZIMBABWE DEFENCE INDUSTRIES (PVT)& LTD";

        assertFalse(screeningStrategy.passedOfacCheck(legalName, itinName));

    }

    @Disabled
    @Test
    public void testOfacMatchDb() {
        AccountInformation accountInfo = new AccountInformation();
        accountInfo.setLegalNm("ZIMBABWE DEFENCE INDUSTRIES (PVT) LTD");
        assertFalse(screeningStrategy.passedOfacCheck(accountInfo));
        accountInfo.setLegalNm("TENTH & CO (PVT) LTD");
        assertFalse(screeningStrategy.passedOfacCheck(accountInfo));
    }

}
